>>>>>> import unittest
>>>>>> from model.game import GameState
>>>>>> from model.board import Board, DEN_POS
>>>>>> from model.types import Player, Animal, Piece
>>>>>> from model.rules import is_legal_move
       
       
>>>>>> def setup_minimal(gs: GameState):
    6:     gs.board.pieces.clear()
       
       
>>>>>> def place(gs: GameState, animal: Animal, owner: Player, x: int, y: int):
   12:     p = Piece(animal, owner, x, y)
   12:     gs.board.place_piece(p, x, y)
   12:     return p
       
       
>>>>>> class TestRules(unittest.TestCase):
>>>>>>     def test_cannot_enter_own_den(self):
    1:         gs = GameState()
    1:         setup_minimal(gs)
               # Put a dog next to own den and try to enter
    1:         dx, dy = (3, 8)
    1:         place(gs, Animal.DOG, Player.P1, 3, 7)
    1:         ok, msg = gs.legal_move((3, 7), (dx, dy))
    1:         self.assertFalse(ok)
       
>>>>>>     def test_rat_water_and_capture_elephant(self):
    1:         gs = GameState()
    1:         setup_minimal(gs)
               # Rat can enter water, but cannot capture elephant from water
               # Place rat in river (1,3) and elephant adjacent on land at (1,2)
    1:         place(gs, Animal.RAT, Player.P1, 1, 3)
    1:         place(gs, Animal.ELEPHANT, Player.P2, 1, 2)
    1:         ok, msg = gs.legal_move((1, 3), (1, 2))
    1:         self.assertFalse(ok)  # cannot from water
               # Now put rat on land at (1,1) and elephant at (1,2) to test rat>elephant
    1:         setup_minimal(gs)
    1:         place(gs, Animal.RAT, Player.P1, 1, 1)
    1:         place(gs, Animal.ELEPHANT, Player.P2, 1, 2)
    1:         ok, msg = gs.legal_move((1, 1), (1, 2))
    1:         self.assertTrue(ok)
       
>>>>>>     def test_lion_jump_blocked_by_rat(self):
    1:         gs = GameState()
    1:         setup_minimal(gs)
               # Place lion at (0,2) and attempt jump to (0,6) across river rows 3..5
    1:         place(gs, Animal.LION, Player.P1, 0, 2)
               # Place blocking rat in river at (0,3) (not a river square; rivers are columns 1,2,4,5) -> adjust to (1,3)
    1:         gs.board.remove_piece(0, 2)  # reset
    1:         place(gs, Animal.LION, Player.P1, 1, 2)  # column 1 above river
    1:         place(gs, Animal.RAT, Player.P1, 1, 3)   # in river
               # Try jump from (1,2) to (1,6)
    1:         ok, msg = gs.legal_move((1, 2), (1, 6))
    1:         self.assertFalse(ok)
       
>>>>>>     def test_trap_capture_any(self):
    1:         gs = GameState()
    1:         setup_minimal(gs)
               # Put weak cat to capture strong elephant in own traps
               # P1 traps at (2,8),(4,8),(3,7)
    1:         place(gs, Animal.ELEPHANT, Player.P2, 3, 7)  # enemy in our trap
    1:         place(gs, Animal.CAT, Player.P1, 3, 6)
    1:         ok, msg = gs.legal_move((3, 6), (3, 7))
    1:         self.assertTrue(ok)
       
>>>>>>     def test_undo_limit(self):
    1:         gs = GameState()
    1:         setup_minimal(gs)
               # Place two rats to shuffle
    1:         place(gs, Animal.RAT, Player.P1, 0, 6)
    1:         place(gs, Animal.RAT, Player.P2, 0, 2)
               # Make 3 moves and undo each time by same player (simulate alternating)
    4:         for i in range(3):
    3:             ok, _ = gs.move((0, 6), (0, 5))
    3:             self.assertTrue(ok)
    3:             ok, _ = gs.undo()
    3:             self.assertTrue(ok)
               # Fourth undo should fail for P1
    1:         ok, msg = gs.undo()
    1:         self.assertFalse(ok)
       
       
>>>>>> if __name__ == '__main__':
>>>>>>     unittest.main()
